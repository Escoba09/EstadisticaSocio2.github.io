<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Práctica dirigida 4</title>

<script src="site_libs/header-attrs-2.27/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Material para pds</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Inicio</a>
</li>
<li>
  <a href="pd1.html">Práctica dirigida 1</a>
</li>
<li>
  <a href="pd2.html">Práctica dirigida 2</a>
</li>
<li>
  <a href="pd3.html">Práctica dirigida 3</a>
</li>
<li>
  <a href="pd4.html">Práctica dirigida 4</a>
</li>
<li>
  <a href="pd5.html">Práctica dirigida 5</a>
</li>
<li>
  <a href="pd6.html">Práctica dirigida 6</a>
</li>
<li>
  <a href="pd7.html">Práctica dirigida 7</a>
</li>
<li>
  <a href="pd8.html">Práctica dirigida 8</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Práctica dirigida 4</h1>

</div>


<p><strong>FACULTAD DE CIENCIAS SOCIALES - PUCP</strong></p>
<p>Curso: SOC294 - Estadística para el análisis sociológico 2</p>
<p>Semestre 2025 - 1</p>
<div id="diferencias-en-diferencias-dif-in-dif" class="section level1">
<h1><strong>Diferencias en Diferencias (Dif-in-Dif)</strong></h1>
<p>Este método es una herramienta poderosa y muy utilizada en ciencias
sociales para evaluar el impacto de políticas, programas o
intervenciones sociales. Si alguna vez te has preguntado cómo medir el
efecto real de una nueva ley, un programa social o cualquier
intervención, este método te será de gran ayuda.</p>
<div id="qué-es-dif-in-dif" class="section level3">
<h3><strong>¿Qué es Dif-in-Dif?</strong></h3>
<p>Diferencias en Diferencias es una técnica que compara cambios a lo
largo del tiempo entre un grupo que recibe una intervención (grupo de
tratamiento) y otro que no la recibe (grupo de control). La idea es
simple pero poderosa: si queremos saber el efecto de una política, no
solo comparamos grupos antes y después, sino que también tomamos en
cuenta las diferencias que ya existían entre ellos.</p>
</div>
<div id="por-qué-es-útil-en-sociología" class="section level3">
<h3>¿Por qué es útil en sociología?</h3>
<p>En sociología, muchas veces nos enfrentamos a preguntas como:</p>
<ul>
<li><p>¿Funcionó realmente esa política pública para reducir la
pobreza?</p></li>
<li><p>¿El programa de educación mejoró el rendimiento escolar?</p></li>
<li><p>¿La intervención comunitaria redujo los niveles de
violencia?</p></li>
</ul>
<p>Dif-in-Dif nos permite responder estas preguntas de manera más
precisa, controlando factores que podrían confundir nuestros
resultados.</p>
</div>
<div id="cómo-funciona" class="section level3">
<h3>¿Cómo funciona?</h3>
<p>Antes y después: Observamos qué pasó antes y después de la
intervención en ambos grupos.</p>
<p>Comparación entre grupos: Comparamos el grupo que recibió la
intervención con el que no la recibió.</p>
<p>Aislamos el efecto: Restamos las diferencias naturales entre los
grupos (que existían antes de la intervención) para quedarnos solo con
el efecto de la intervención.</p>
</div>
<div id="ecuación" class="section level3">
<h3>Ecuación</h3>
<p><strong><em>EFECTO DIF-IN-DIF = (Y_post,T - Y_pre,T) - (Y_post,C -
Y_pre,C)</em></strong></p>
<p><strong>Y_post,T</strong>: Resultado promedio del grupo de
tratamiento después de la intervención.</p>
<p><strong>Y_pre,T</strong>: Resultado promedio del grupo de tratamiento
antes de la intervención.</p>
<p><strong>Y_post,C</strong>: Resultado promedio del grupo de control
después de la intervención.</p>
<p><strong>Y_pre,C</strong>: Resultado promedio del grupo de control
antes de la intervención.</p>
<ul>
<li><p>Primera diferencia (grupo de tratamiento): Calculas la diferencia
en el resultado del grupo de tratamiento antes y después de la
intervención: Diferencia Tratamiento = Y_post,T - Y_pre,T</p></li>
<li><p>Segunda diferencia (grupo de control): Calculas la diferencia en
el resultado del grupo de control antes y después de la intervención:
Diferencia Control = Y_post,C - Y_pre,C</p></li>
<li><p>Diferencias en Diferencias: Restas la diferencia del grupo de
control a la diferencia del grupo de tratamiento para aislar el efecto
de la intervención: EFECTO DIF-IN-DIF = Diferencia Tratamiento -
Diferencia Control</p></li>
</ul>
</div>
<div id="lo-necesario-para-un-dif---in---dif" class="section level3">
<h3>Lo necesario para un Dif - in - Dif</h3>
<p><strong>Asignación aleatoria (o casi aleatoria) de los grupos de
tratamiento y control.</strong></p>
<p>¿Qué significa? El grupo que recibe la intervención (tratamiento) y
el grupo que no la recibe (control) deben ser comparables. Idealmente,
la asignación a estos grupos debería ser aleatoria, como en un
experimento. Sin embargo, en muchos casos de sociología o economía, esto
no es posible, por lo que se busca que la asignación sea “casi
aleatoria” (es decir, que no haya diferencias sistemáticas entre los
grupos antes de la intervención).</p>
<p><strong>Un período previo y un período posterior para ambos
grupos.</strong></p>
<p>¿Qué significa? Necesitas datos de ambos grupos (tratamiento y
control) antes y después de la intervención. Esto te permite comparar
cómo cambian los resultados en ambos grupos a lo largo del tiempo.</p>
<p><strong>Sin sesgo de selección de la muestra.</strong></p>
<p>¿Qué significa? Los grupos de tratamiento y control deben ser
seleccionados de manera que no haya un sesgo sistemático en su
composición. Por ejemplo, si el grupo de tratamiento tiene
características inherentemente diferentes al grupo de control (como un
mayor nivel socioeconómico), esto podría distorsionar los
resultados.</p>
<p><strong>Debe haber tendencias paralelas.</strong></p>
<p>¿Qué significa? Antes de la intervención, los grupos de tratamiento y
control deben seguir tendencias paralelas en la variable de resultado.
Es decir, si el grupo de tratamiento estaba aumentando (o disminuyendo)
su resultado a una tasa similar a la del grupo de control, se asume que,
en ausencia de la intervención, esta tendencia habría continuado.</p>
</div>
<div id="ejemplo-sencillo" class="section level3">
<h3>Ejemplo sencillo:</h3>
<p>Imagina que un gobierno implementa un programa de becas para mejorar
el rendimiento académico en ciertas escuelas (grupo de tratamiento).
Otras escuelas no reciben el programa (grupo de control). Con
Dif-in-Dif, comparamos el cambio en el rendimiento antes y después del
programa en ambas escuelas. Si el grupo de tratamiento mejora más que el
de control, podemos atribuir esa diferencia al programa de becas.</p>
<p>Ecuación de la regresión DiD</p>
<p>Yit​=β0​+β1​⋅Treatedi​+β2​⋅Postt​+β3​⋅(Treatedi​×Postt​)+εit</p>
<p>Variables explicadas:</p>
<p>• Yit → Variable de resultado para la unidad ii en el tiempo tt. •
Treatedi → Variable binaria (1 si la unidad ii pertenece al grupo de
tratamiento, 0 si es control). • Postt → Variable binaria (1 si el
periodo tt es posterior a la intervención, 0 si es antes). •
Treatedi×Postt → Término de interacción (captura el efecto causal del
tratamiento). • εit → Término de error.</p>
<p>Interpretación de coeficientes: • β0 → Media de Y para el grupo de
control en el periodo previo. • β1 → Diferencia inicial entre grupos
(tratamiento vs. control) antes de la intervención. • β2 → Cambio
temporal común (efecto de tendencia en el grupo de control). • β3 →
Efecto Dif-in-Dif (efecto causal del tratamiento).</p>
</div>
</div>
<div
id="minimum-wages-and-employment-a-case-study-of-the-fast-food-industry-in-new-jersey-and-pennsylvania"
class="section level1">
<h1><strong>Minimum Wages and Employment: A Case Study of the Fast-Food
Industry in New Jersey and Pennsylvania</strong></h1>
<pre class="r"><code>library(dplyr)</code></pre>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<pre class="r"><code>library(readr)
library(ggplot2)
library(tidyr)
library(sjlabelled)</code></pre>
<pre><code>## Warning: package &#39;sjlabelled&#39; was built under R version 4.4.2</code></pre>
<pre><code>## 
## Attaching package: &#39;sjlabelled&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     as_label</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     as_label</code></pre>
<pre class="r"><code>library(ggrepel)
library(scales)</code></pre>
<pre><code>## 
## Attaching package: &#39;scales&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:readr&#39;:
## 
##     col_factor</code></pre>
<pre class="r"><code>library(ggpubr)
library(plm)</code></pre>
<pre><code>## Warning: package &#39;plm&#39; was built under R version 4.4.2</code></pre>
<pre><code>## 
## Attaching package: &#39;plm&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     between, lag, lead</code></pre>
<pre class="r"><code>library(lmtest)</code></pre>
<pre><code>## Loading required package: zoo</code></pre>
<pre><code>## 
## Attaching package: &#39;zoo&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     as.Date, as.Date.numeric</code></pre>
<pre class="r"><code>library(rio)
data=import(&quot;DD1.RData&quot;)</code></pre>
<pre><code>## Warning: The `trust` argument of `import()` should be explicit for serialization formats
## as of rio 1.0.3.
## ℹ Missing `trust` will be set to FALSE by default for RData in 2.0.0.
## ℹ The deprecated feature was likely used in the rio package.
##   Please report the issue at &lt;https://github.com/gesistsa/rio/issues&gt;.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<pre class="r"><code>#Según el documento, los equivalentes a tiempo completo o full time employment (FTE) se componen de empleados a tiempo completo, directivos y empleados a tiempo parcial (emptot). Estos últimos se multiplican por el factor 0,5 antes de entrar en el cálculo. Además, se genera la proporción de empleados a tiempo completo de todos los ETC (pct_ftw).

#emptot = empft + nmgrs + 0.5 * emppt

#pct_fte = empft / emptot * 100</code></pre>
<div id="estadísticos-descriptivos" class="section level2">
<h2>Estadísticos descriptivos</h2>
<pre class="r"><code>data %&gt;%
  select(chain, state) %&gt;%
  table() %&gt;%
  prop.table(margin = 2)  %&gt;%
  apply(MARGIN = 2,
        FUN = scales::percent_format(accuracy = 0.1)) %&gt;%
  noquote</code></pre>
<pre><code>##         state
## chain    New Jersey Pennsylvania
##   bk     41.1%      44.3%       
##   kfc    20.5%      15.2%       
##   roys   24.8%      21.5%       
##   wendys 13.6%      19.0%</code></pre>
<div id="pre-tratamiento" class="section level3">
<h3>Pre-tratamiento</h3>
<pre class="r"><code>data %&gt;%
  filter(observation == &quot;February 1992&quot;) %&gt;%
  group_by(state) %&gt;%
  summarise(emptot = mean(emptot, na.rm = TRUE),
            pct_fte  = mean(pct_fte, na.rm = TRUE),
            wage_st = mean(wage_st, na.rm = TRUE),
            hrsopen = mean(hrsopen, na.rm = TRUE)) %&gt;%
  pivot_longer(cols=-state, names_to = &quot;variable&quot;) %&gt;%
  pivot_wider(names_from = state, values_from = value)</code></pre>
<pre><code>## # A tibble: 4 × 3
##   variable `New Jersey` Pennsylvania
##   &lt;chr&gt;           &lt;dbl&gt;        &lt;dbl&gt;
## 1 emptot          20.4         23.3 
## 2 pct_fte         32.8         35.0 
## 3 wage_st          4.61         4.63
## 4 hrsopen         14.4         14.5</code></pre>
</div>
<div id="pos-tratamiento" class="section level3">
<h3>Pos-tratamiento</h3>
<pre class="r"><code>data %&gt;%
  filter(observation == &quot;November 1992&quot;) %&gt;%
  group_by(state) %&gt;%
  summarise(emptot = mean(emptot, na.rm = TRUE),
            pct_fte  = mean(pct_fte, na.rm = TRUE),
            wage_st = mean(wage_st, na.rm = TRUE),
            hrsopen = mean(hrsopen, na.rm = TRUE)) %&gt;%
  pivot_longer(cols=-state, names_to = &quot;variable&quot;) %&gt;%
  pivot_wider(names_from = state, values_from = value)</code></pre>
<pre><code>## # A tibble: 4 × 3
##   variable `New Jersey` Pennsylvania
##   &lt;chr&gt;           &lt;dbl&gt;        &lt;dbl&gt;
## 1 emptot          21.0         21.2 
## 2 pct_fte         35.9         30.4 
## 3 wage_st          5.08         4.62
## 4 hrsopen         14.4         14.7</code></pre>
</div>
</div>
<div id="rango-salarial-antes-y-después-de-la-política"
class="section level2">
<h2>Rango salarial antes y después de la política</h2>
<pre class="r"><code># Histograma para febrero de 1992 
hist.feb &lt;- data %&gt;%
  filter(observation == &quot;February 1992&quot;) %&gt;%
  ggplot(aes(x = wage_st, fill = state)) +
  geom_histogram(
    aes(y = after_stat(100 * count / tapply(count, group, sum)[group])),
    alpha = 0.5,
    position = &quot;dodge&quot;,
    bins = 23
  ) +
  labs(
    title = &quot;Febrero 1992&quot;,
    x = &quot;Rango Salarial&quot;,
    y = &quot;Porcentaje de tiendas&quot;,
    fill = &quot;&quot;
  ) +
  scale_fill_grey() +
  scale_y_continuous(limits = c(0, 100))

# Histograma para noviembre de 1992 
hist.nov &lt;- data %&gt;%
  filter(observation == &quot;November 1992&quot;) %&gt;%
  ggplot(aes(x = wage_st, fill = state)) +
  geom_histogram(
    aes(y = after_stat(100 * count / tapply(count, group, sum)[group])),
    alpha = 0.5,
    position = &quot;dodge&quot;,
    bins = 23
  ) +
  labs(
    title = &quot;Noviembre 1992&quot;,
    x = &quot;Rango Salarial&quot;,
    y = &quot;Porcentaje de tiendas&quot;,
    fill = &quot;&quot;
  ) +
  scale_fill_grey() +
  scale_y_continuous(limits = c(0, 100))

# Combinar los gráficos
ggpubr::ggarrange(
  hist.feb, 
  hist.nov, 
  ncol = 2,
  common.legend = TRUE,
  legend = &quot;bottom&quot;)</code></pre>
<pre><code>## Warning: Removed 20 rows containing non-finite outside the scale range (`stat_bin()`).
## Removed 20 rows containing non-finite outside the scale range (`stat_bin()`).</code></pre>
<pre><code>## Warning: Removed 21 rows containing non-finite outside the scale range
## (`stat_bin()`).</code></pre>
<p><img src="pd4_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="cálculo-del-efecto-del-tratamiento" class="section level2">
<h2>Cálculo del efecto del tratamiento</h2>
<div id="primeras-diferencias" class="section level3">
<h3>Primeras diferencias</h3>
<pre class="r"><code>differences &lt;- data %&gt;%
  group_by(observation, state) %&gt;%
  summarise(emptot = mean(emptot, na.rm = TRUE))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;observation&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code># Treatment group (NJ) before treatment
njfeb &lt;- differences[1,3]

# Control group (PA) before treatment
pafeb &lt;- differences[2,3]

# Treatment group (NJ) after treatment
njnov &lt;- differences[3,3]

# Control group (PA) after treatment
panov &lt;- differences[4,3]</code></pre>
</div>
<div id="ate" class="section level3">
<h3>ATE</h3>
<p>El efecto medio del tratamiento o Average Treatment Effect (ATE) se
refiere al efecto promedio que tiene una intervención, tratamiento o
política sobre el grupo que la recibió (el grupo de tratamiento). En
otras palabras, el ATT mide cuánto cambió el resultado de interés (por
ejemplo, ingresos, rendimiento académico, salud) para aquellos que
recibieron el tratamiento, en comparación con lo que habría ocurrido si
no lo hubieran recibido.</p>
<p>En este contexto puede determinarse de dos maneras:</p>
<ul>
<li>calcular la diferencia entre la diferencia de noviembre y febrero
dentro de NJ y PA</li>
</ul>
<pre class="r"><code>(njnov-njfeb)-(panov-pafeb) </code></pre>
<pre><code>##     emptot
## 1 2.753606</code></pre>
<ul>
<li>calcular la diferencia entre la diferencia de NJ y PA entre
noviembre y febrero</li>
</ul>
<pre class="r"><code>(njnov-panov)-(njfeb-pafeb)</code></pre>
<pre><code>##     emptot
## 1 2.753606</code></pre>
</div>
</div>
<div id="outcome-contrafactual" class="section level2">
<h2>Outcome contrafactual</h2>
<p>Representar gráficamente la relación entre el grupo de tratamiento y
el de control puede ser muy útil para comprender el enfoque DiD. En
primer lugar, se utiliza las diferencias de la variable emptot
calculadas en el paso anterior para NJ y PJ en febrero y noviembre.
Además, necesitamos el resultado de NJ si el tratamiento (aumento del
salario mínimo) no se hubiera producido. Esto se denomina resultado
contrafactual (nj_counterfactual). El supuesto DiD establece que las
tendencias del grupo de tratamiento y del grupo de control son idénticas
hasta que tiene lugar el tratamiento. Por lo tanto, sin el tratamiento,
el empleo (emptot) de NJ disminuiría de febrero a noviembre en la misma
proporción que el de PA. Se añade tres puntos de datos adicionales para
representar una línea de intervención en el gráfico que indica el evento
de tratamiento.</p>
<pre class="r"><code># Calculate counterfactual outcome
nj_counterfactual &lt;- tibble(
  observation = c(&quot;February 1992&quot;,&quot;November 1992&quot;), 
  state = c(&quot;New Jersey (Counterfactual)&quot;,&quot;New Jersey (Counterfactual)&quot;),
  emptot = as.numeric(c(njfeb, njfeb-(pafeb-panov)))
  ) 

# Data points for treatment event
intervention &lt;- tibble(
    observation = c(&quot;Intervention&quot;, &quot;Intervention&quot;, &quot;Intervention&quot;),
    state = c(&quot;New Jersey&quot;, &quot;Pennsylvania&quot;, &quot;New Jersey (Counterfactual)&quot;),
    emptot = c(19.35, 22.3, 19.35)
  ) 

# Combine data
did_plotdata &lt;- bind_rows(differences, 
                          nj_counterfactual, 
                          intervention)</code></pre>
<pre class="r"><code>did_plotdata %&gt;%
  mutate(label = if_else(observation == &quot;November 1992&quot;, as.character(state), NA_character_)) %&gt;%
  ggplot(aes(x=observation,y=emptot, group=state)) +
  geom_line(aes(color=state), size=1.2) +
  geom_vline(xintercept = &quot;Intervention&quot;, linetype=&quot;dotted&quot;, 
             color = &quot;black&quot;, size=1.1) + 
  scale_color_brewer(palette = &quot;Accent&quot;) +
  scale_y_continuous(limits = c(17,24)) +
  ggrepel::geom_label_repel(aes(label = label),
                   nudge_x = 0.5, nudge_y = -0.5,
                   na.rm = TRUE) +
  guides(color=FALSE) +
  labs(x=&quot;&quot;, y=&quot;FTE (promedio)&quot;) +
  annotate(
    &quot;text&quot;,
    x = &quot;Noviembre 1992&quot;,
    y = 19.6,
    label = &quot;{Difference-in-Differences}&quot;,
    angle = 90,
    size = 3
  )</code></pre>
<pre><code>## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
## ℹ Please use `linewidth` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<pre><code>## Warning: The `&lt;scale&gt;` argument of `guides()` cannot be `FALSE`. Use &quot;none&quot; instead as
## of ggplot2 3.3.4.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<p><img src="pd4_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div id="cálculo-del-estimador-did" class="section level2">
<h2>Cálculo del estimador DiD</h2>
<div id="creación-de-la-variable-dummy" class="section level3">
<h3>Creación de la variable dummy</h3>
<p>Con la regresión lineal, este resultado puede obtenerse muy
fácilmente. En primer lugar, tenemos que crear dos variables ficticias.
Una indica el inicio del tratamiento (tiempo) y es igual a cero antes
del tratamiento e igual a uno después del tratamiento. La otra variable
separa las observaciones en un grupo de tratamiento y otro de control
(tratados). Esta variable ficticia es igual a uno para los restaurantes
de comida rápida situados en Nueva Jersey e igual a cero para los
situados en Pensilvania.</p>
<pre class="r"><code>data &lt;- mutate(data, time = ifelse(observation == &quot;November 1992&quot;, 1, 0),
                     treated = ifelse(state == &quot;New Jersey&quot;, 1, 0)
                      )</code></pre>
</div>
<div id="regresión" class="section level3">
<h3>Regresión</h3>
<p><em>Y = b0 + b1 * Tratamiento + b2 * Post + b3 * (Tratamiento * Post)
+ Error</em></p>
<p><strong>Y</strong>: Es la variable de resultado que estás midiendo
(por ejemplo, salario, rendimiento académico, etc.).</p>
<p><strong>b0:</strong> Es el valor esperado de Y cuando todas las demás
variables son cero. Representa el valor base del grupo de control antes
de la intervención.</p>
<p><strong>b1 * Tratamiento</strong>:</p>
<p><strong>Tratamiento:</strong> Es una variable binaria que toma el
valor 1 si el individuo pertenece al grupo de tratamiento y 0 si
pertenece al grupo de control.</p>
<p><strong>b1</strong>: Mide la diferencia en Y entre el grupo de
tratamiento y el grupo de control antes de la intervención.</p>
<p><strong>b2 * Post:</strong></p>
<p><strong>Post:</strong> Es una variable binaria que toma el valor 1 si
es el período posterior a la intervención y 0 si es el período
anterior.</p>
<p><strong>b2:</strong> Mide el cambio en Y para el grupo de control
entre el período anterior y posterior a la intervención.</p>
<p><strong>b3 * (Tratamiento * Post):</strong></p>
<p><strong>Tratamiento * Post</strong>: Es la interacción entre las
variables “Tratamiento” y “Post”. Toma el valor 1 solo para el grupo de
tratamiento en el período posterior a la intervención.</p>
<p><strong>b3</strong>: Es el coeficiente de interés. Mide el efecto
DiD, es decir, el impacto de la intervención en el grupo de tratamiento
después de la intervención, neto de los cambios en el grupo de
control.</p>
<p><strong>Error</strong>: Representa los factores no observados que
afectan a Y.</p>
<pre class="r"><code>did_model &lt;- lm(emptot ~ time + treated + time:treated, data = data)
summary(did_model)</code></pre>
<pre><code>## 
## Call:
## lm(formula = emptot ~ time + treated + time:treated, data = data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -21.166  -6.439  -1.027   4.473  64.561 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    23.331      1.072  21.767   &lt;2e-16 ***
## time           -2.166      1.516  -1.429   0.1535    
## treated        -2.892      1.194  -2.423   0.0156 *  
## time:treated    2.754      1.688   1.631   0.1033    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 9.406 on 790 degrees of freedom
##   (26 observations deleted due to missingness)
## Multiple R-squared:  0.007401,   Adjusted R-squared:  0.003632 
## F-statistic: 1.964 on 3 and 790 DF,  p-value: 0.118</code></pre>
</div>
</div>
<div id="efectos-fijos" class="section level2">
<h2>Efectos fijos</h2>
<pre class="r"><code># Declare as panel data
panel &lt;- pdata.frame(data, &quot;sheet&quot;)</code></pre>
<pre><code>## Warning in pdata.frame(data, &quot;sheet&quot;): column &#39;time&#39; overwritten by time index</code></pre>
<pre class="r"><code># Within model
did.reg &lt;- plm(emptot ~ time + treated + time:treated, 
               data = panel, model = &quot;within&quot;)

# obtain clustered standard errors
coeftest(did.reg, vcov = function(x) 
  vcovHC(x, cluster = &quot;group&quot;, type = &quot;HC1&quot;))</code></pre>
<pre><code>## 
## t test of coefficients:
## 
##               Estimate Std. Error t value Pr(&gt;|t|)  
## time2          -2.2833     1.2465 -1.8319  0.06775 .
## time2:treated   2.7500     1.3359  2.0585  0.04022 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
