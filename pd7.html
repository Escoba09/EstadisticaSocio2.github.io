<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Práctica dirigida 7</title>

<script src="site_libs/header-attrs-2.21/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Material para pds</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Inicio</a>
</li>
<li>
  <a href="pd1.html">Práctica dirigida 1</a>
</li>
<li>
  <a href="pd2.html">Práctica dirigida 2</a>
</li>
<li>
  <a href="pd3.html">Práctica dirigida 3</a>
</li>
<li>
  <a href="pd4.html">Práctica dirigida 4</a>
</li>
<li>
  <a href="pd5.html">Práctica dirigida 5</a>
</li>
<li>
  <a href="pd6.html">Práctica dirigida 6</a>
</li>
<li>
  <a href="pd7.html">Práctica dirigida 7</a>
</li>
<li>
  <a href="pd8.html">Práctica dirigida 8</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Práctica dirigida 7</h1>

</div>


<p><strong>FACULTAD DE CIENCIAS SOCIALES - PUCP</strong></p>
<p>Curso: SOC285 - Estadística para el análisis sociológico 2</p>
<p>Semestre 2025 - 1</p>
<div id="regression-discontinuity-design-2" class="section level1">
<h1><strong>Regression Discontinuity Design (2)</strong></h1>
<p>Sin un proceso aleatorio que separe el grupo de tratamiento del de
control, el efecto del tratamiento puede identificarse si la asignación
al grupo de tratamiento sigue un diseño de discontinuidad de regresión
(RDD). Esto requiere una variable (running) que, en un determinado
umbral, separe las observaciones en un grupo de tratamiento y otro de
control.</p>
<pre class="r"><code>library(dplyr)</code></pre>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<pre class="r"><code>library(ggplot2)
library(magrittr)</code></pre>
<pre class="r"><code>library(rio)</code></pre>
<pre><code>## Warning: package &#39;rio&#39; was built under R version 4.3.1</code></pre>
<pre class="r"><code>data = import(&quot;mlda.rda&quot;)</code></pre>
</div>
<div
id="the-effect-of-alcohol-consumption-on-mortality-regression-discontinuity-evidence-from-the-minimum-drinking-age"
class="section level1">
<h1>The Effect of Alcohol Consumption on Mortality: Regression
Discontinuity Evidence from the Minimum Drinking Age</h1>
<p>Los autores buscan calcular el efecto del consumo de alcohol en la
mortalidad utilizando la edad mínima para consumir alcohol en un diseño
de regresión discontinua.</p>
<pre class="r"><code>data %&gt;% 
  ggplot(aes(x = agecell, y = all)) + 
  geom_point() +
  geom_vline(xintercept = 21, color = &quot;red&quot;, size = 1, linetype = &quot;dashed&quot;) + 
  annotate(&quot;text&quot;, x = 20.4, y = 105, label = &quot;Mínima Edad para Tomar&quot;,
           size=4) +
  labs(y = &quot;Tasa de mortalidad (por 100.000)&quot;,
       x = &quot;Edad (binned)&quot;)</code></pre>
<pre><code>## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
## ℹ Please use `linewidth` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<pre><code>## Warning: Removed 2 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="pd7_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<div id="estimando-las-mismas-pendientes-con-ols"
class="section level2">
<h2>Estimando las mismas pendientes (con OLS)</h2>
<p>En primer lugar, tenemos que calcular una variable dummy
(umbral/threshold) que indique si una persona está por debajo o por
encima del umbral. La variable dummy es igual a cero para las
observaciones por debajo e igual a uno para las observaciones por encima
del umbral de 21 años. A continuación, se especifa un modelo lineal con
la función lm() para hacer una regresión de todas las muertes por
100.000 (all) en la variable dummy del umbral y la edad de los
encuestados, que se centra en torno al valor umbral de age (21 años).
Esto se hace con la función I() restando el umbral de cada tramo de
edad.</p>
<pre class="r"><code>lm_misma_pendiente &lt;- data %&gt;% 
  mutate(threshold = ifelse(agecell &gt;= 21, 1, 0)) %$% 
  lm(all ~ threshold + I(agecell - 21))

summary(lm_misma_pendiente) </code></pre>
<pre><code>## 
## Call:
## lm(formula = all ~ threshold + I(agecell - 21))
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.0559 -1.8483  0.1149  1.4909  5.8043 
## 
## Coefficients:
##                 Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)      91.8414     0.8050 114.083  &lt; 2e-16 ***
## threshold         7.6627     1.4403   5.320 3.15e-06 ***
## I(agecell - 21)  -0.9747     0.6325  -1.541     0.13    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.493 on 45 degrees of freedom
##   (2 observations deleted due to missingness)
## Multiple R-squared:  0.5946, Adjusted R-squared:  0.5765 
## F-statistic: 32.99 on 2 and 45 DF,  p-value: 1.508e-09</code></pre>
<p>El coeficiente de la variable ficticia umbral es el efecto medio del
tratamiento. En promedio, la tasa de mortalidad por 100.000 de las
personas que alcanzan la edad mínima para consumir alcohol es 7,66
puntos superior.</p>
<pre class="r"><code>data %&gt;%
  select(agecell, all) %&gt;%
  mutate(threshold = as.factor(ifelse(agecell &gt;= 21, 1, 0))) %&gt;%
  ggplot(aes(x = agecell, y = all)) +
  geom_point(aes(color = threshold)) +
  geom_smooth(method = &quot;lm&quot;, se = FALSE) +
  scale_color_brewer(palette = &quot;Accent&quot;) +
  guides(color = FALSE) +
  geom_vline(xintercept = 21, color = &quot;red&quot;,
    size = 1, linetype = &quot;dashed&quot;) +
  labs(y = &quot;Tasa de mortalidad (por 100.000)&quot;,
       x = &quot;Edad (binned)&quot;)</code></pre>
<pre><code>## Warning: The `&lt;scale&gt;` argument of `guides()` cannot be `FALSE`. Use &quot;none&quot; instead as
## of ggplot2 3.3.4.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 2 rows containing non-finite values (`stat_smooth()`).</code></pre>
<pre><code>## Warning: Removed 2 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="pd7_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="estimando-pendientes-distintas-con-ols" class="section level2">
<h2>Estimando pendientes distintas (con OLS)</h2>
<pre class="r"><code>lm_diferente_pendiente &lt;- data %&gt;%
  mutate(threshold = ifelse(agecell &gt;= 21, 1, 0)) %$%
  lm(all ~ threshold + I(agecell - 21) + threshold:I(agecell - 21))

summary(lm_diferente_pendiente)</code></pre>
<pre><code>## 
## Call:
## lm(formula = all ~ threshold + I(agecell - 21) + threshold:I(agecell - 
##     21))
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -4.368 -1.787  0.117  1.108  5.341 
## 
## Coefficients:
##                           Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                93.6184     0.9325 100.399  &lt; 2e-16 ***
## threshold                   7.6627     1.3187   5.811  6.4e-07 ***
## I(agecell - 21)             0.8270     0.8189   1.010  0.31809    
## threshold:I(agecell - 21)  -3.6034     1.1581  -3.111  0.00327 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.283 on 44 degrees of freedom
##   (2 observations deleted due to missingness)
## Multiple R-squared:  0.6677, Adjusted R-squared:  0.645 
## F-statistic: 29.47 on 3 and 44 DF,  p-value: 1.325e-10</code></pre>
<p>Este enfoque no altera la interpretación del efecto del tratamiento.
En promedio, la tasa de mortalidad por 100.000 de las personas que
alcanzan la edad mínima para consumir alcohol es 7,66 puntos
superior.</p>
<pre class="r"><code>data %&gt;%
  select(agecell, all) %&gt;%
  mutate(threshold = as.factor(ifelse(agecell &gt;= 21, 1, 0))) %&gt;%
  ggplot(aes(x = agecell, y = all, color = threshold)) +
  geom_point() +
  geom_smooth(method = &quot;lm&quot;, se = FALSE) +
  scale_color_brewer(palette = &quot;Accent&quot;) +
  guides(color = FALSE) +
  geom_vline(xintercept = 21, color = &quot;red&quot;,
    size = 1, linetype = &quot;dashed&quot;) +
  labs(y = &quot;Tasa de mortalidad (por 100.000)&quot;,
       x = &quot;Edad (binned)&quot;)</code></pre>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 2 rows containing non-finite values (`stat_smooth()`).</code></pre>
<pre><code>## Warning: Removed 2 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="pd7_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="regresión-discontinua-polinómica-de-segundo-orden-con-ols"
class="section level2">
<h2>Regresión discontinua polinómica de segundo orden (con OLS)</h2>
<pre class="r"><code>lm_cuadratica &lt;- data %&gt;% 
mutate(threshold = ifelse(agecell &gt;= 21, 1, 0)) %$% 
  lm(all ~ threshold + I(agecell - 21) + I((agecell -21)^2) + threshold:I(agecell - 21) +
       threshold:I((agecell - 21)^2))

summary(lm_cuadratica)</code></pre>
<pre><code>## 
## Call:
## lm(formula = all ~ threshold + I(agecell - 21) + I((agecell - 
##     21)^2) + threshold:I(agecell - 21) + threshold:I((agecell - 
##     21)^2))
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.3343 -1.3946  0.1849  1.2848  5.0817 
## 
## Coefficients:
##                               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                    93.0729     1.4038  66.301  &lt; 2e-16 ***
## threshold                       9.5478     1.9853   4.809 1.97e-05 ***
## I(agecell - 21)                -0.8306     3.2901  -0.252    0.802    
## I((agecell - 21)^2)            -0.8403     1.6153  -0.520    0.606    
## threshold:I(agecell - 21)      -6.0170     4.6529  -1.293    0.203    
## threshold:I((agecell - 21)^2)   2.9042     2.2843   1.271    0.211    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.285 on 42 degrees of freedom
##   (2 observations deleted due to missingness)
## Multiple R-squared:  0.6821, Adjusted R-squared:  0.6442 
## F-statistic: 18.02 on 5 and 42 DF,  p-value: 1.624e-09</code></pre>
<pre class="r"><code>data %&gt;%
  select(agecell, all) %&gt;%
  mutate(threshold = as.factor(ifelse(agecell &gt;= 21, 1, 0))) %&gt;%
  ggplot(aes(x = agecell, y = all, color = threshold)) +
  geom_point() +
  geom_smooth(method = &quot;lm&quot;,
              formula = y ~ x + I(x ^ 2),
              se = FALSE) +
  scale_color_brewer(palette = &quot;Accent&quot;) +
  guides(color = FALSE) +
  geom_vline(xintercept = 21, color = &quot;red&quot;,
    size = 1, linetype = &quot;dashed&quot;) +
  labs(y = &quot;Tasa de mortalidad (por 100.000)&quot;,
       x = &quot;Edad (binned)&quot;)</code></pre>
<pre><code>## Warning: Removed 2 rows containing non-finite values (`stat_smooth()`).</code></pre>
<pre><code>## Warning: Removed 2 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="pd7_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>y=β 0 ​ +β 1 ​ D+β 2 ​ x+β 3 ​ x 2 +β 4 ​ x right ​ +β 5 ​ x right 2 ​ +ϵ</p>
<p>D: Tratamiento (1 si x ≥ 21).</p>
<p>x: Variable de asignación (centrada en 21: x = agecell - 21).</p>
<p>x^2: Término cuadrático del lado izquierdo</p>
<p>x_right: interacción entre x y el tratamiento.</p>
<p>x^2_right: término cuadrático interactivo.</p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
