---
title: "PC3"
author: "Sebastián Esquives"
date: "2025-04-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Un gobierno municipal implementó una política de subsidios para pequeños comerciantes con el objetivo de impulsar la economía local. La asignación del subsidio se basó en un criterio de ingresos: los comerciantes con ingresos anuales inferiores a $50,000 fueron elegibles para recibirlo, mientras que aquellos con ingresos iguales o superiores a ese umbral no lo fueron.

La base de datos contiene información sobre 500 comerciantes, incluyendo sus ingresos anuales antes de la política, si recibieron el subsidio o no, sus ventas mensuales después de la implementación y otras características sociodemográficas. Esto permite evaluar el impacto del subsidio en el desempeño económico de los comerciantes mediante un diseño de regresión discontinua (RDD).


ingresos_previos: ingresos anuales del comerciante antes del subsidio (variable de corte para RDD).

subsidio: 1 si recibió el subsidio, 0 si no.

ventas_post: ventas mensuales después de la política (variable de resultado).

edad: edad del comerciante.

experiencia: años de experiencia del comerciante.

sector: sector económico al que pertenece el negocio.
```{r}
# Cargar librerías necesarias
library(tidyverse)

# Fijar semilla para reproducibilidad
set.seed(123)

# Número de observaciones
n <- 500

# Generar ingresos anuales previos a la política (variable running variable)
ingresos_previos <- runif(n, 30000, 70000)

# Determinar el sector (solo dos sectores: "Alimentos" y "Ropa")
sector <- sample(c("Alimentos", "Ropa"), n, replace = TRUE)

# Modificar ingresos para los sectores:
# - "Alimentos" tiene un pequeño aumento en los ingresos.
# - "Ropa" tiene una pequeña reducción en los ingresos.
ingresos_previos <- ifelse(sector == "Alimentos", ingresos_previos + runif(n, 500, 3000), ingresos_previos)  # Aumento en ingresos para "Alimentos"
ingresos_previos <- ifelse(sector == "Ropa", ingresos_previos - runif(n, 500, 3000), ingresos_previos)  # Reducción en ingresos para "Ropa"

# Determinar si el comerciante recibió el subsidio (punto de corte en 50000)
subsidio <- ifelse(ingresos_previos < 50000, 1, 0)

# Generar ventas mensuales después de la política con un posible impacto del subsidio
# Para "Alimentos", las ventas aumentan si recibieron subsidio; para "Ropa", disminuyen si recibieron subsidio
ventas_post <- 2000 + 0.1 * ingresos_previos + 500 * subsidio + rnorm(n, 0, 300)

# Otras características sociodemográficas
edad <- sample(25:65, n, replace = TRUE)
experiencia <- sample(1:40, n, replace = TRUE)

# Crear data frame
df_rdd <- data.frame(
  ingresos_previos,
  subsidio,
  ventas_post,
  edad,
  experiencia,
  sector
)

# Ver primeras filas de la base de datos
head(df_rdd)


# Guardar la base de datos en un archivo CSV
#write.csv(df_rdd, "datos_RDD.csv", row.names = FALSE)

```


```{r}
tratados1 <- df_rdd %>% 
  filter(ingresos_previos >= 47000 & ingresos_previos < 50000 & subsidio == 1 & sector == "Ropa") %>% 
  summarise(total = n(),
            promedio_ingresos = mean(ingresos_previos, na.rm = TRUE),
            promedio_ventas = mean(ventas_post, na.rm = TRUE),
            promedio_edad = mean(edad, na.rm = TRUE),
            promedio_experiencia = mean(experiencia, na.rm = TRUE)) %>% 
  mutate(grupo = "Tratamiento")

tratados2 <- df_rdd %>% 
  filter(ingresos_previos >= 47000 & ingresos_previos < 50000 & subsidio == 1 & sector == "Alimentos") %>% 
  summarise(total = n(),
            promedio_ingresos = mean(ingresos_previos, na.rm = TRUE),
            promedio_ventas = mean(ventas_post, na.rm = TRUE),
            promedio_edad = mean(edad, na.rm = TRUE),
            promedio_experiencia = mean(experiencia, na.rm = TRUE)) %>% 
  mutate(grupo = "Tratamiento")

# Estadísticos descriptivos - Grupo de Control
control1 <- df_rdd %>% 
  filter(ingresos_previos >= 50000 & ingresos_previos <= 53000 & subsidio == 0 & sector == "Ropa") %>% 
  summarise(total = n(),
            promedio_ingresos = mean(ingresos_previos, na.rm = TRUE),
            promedio_ventas = mean(ventas_post, na.rm = TRUE),
            promedio_edad = mean(edad, na.rm = TRUE),
            promedio_experiencia = mean(experiencia, na.rm = TRUE)) %>% 
  mutate(grupo = "Control")

control2 <- df_rdd %>% 
  filter(ingresos_previos >= 50000 & ingresos_previos <= 53000 & subsidio == 0 & sector == "Alimentos") %>% 
  summarise(total = n(),
            promedio_ingresos = mean(ingresos_previos, na.rm = TRUE),
            promedio_ventas = mean(ventas_post, na.rm = TRUE),
            promedio_edad = mean(edad, na.rm = TRUE),
            promedio_experiencia = mean(experiencia, na.rm = TRUE)) %>% 
  mutate(grupo = "Control")

# Unir ambos resúmenes
estadisticas_rdd <- bind_rows(tratados1, tratados2, control1, control2)

```


```{r}
# Cargar librerías necesarias
library(tidyverse)

# Modelo de regresión discontinua con OLS
modelo_rdd_ols <- lm(ventas_post ~ subsidio + ingresos_previos + subsidio:ingresos_previos, data = df_rdd)

# Resumen del modelo
summary(modelo_rdd_ols)

# Visualización del RDD
ggplot(df_rdd, aes(x = ingresos_previos, y = ventas_post, color = factor(subsidio))) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", formula = y ~ x, se = FALSE) +
  geom_vline(xintercept = 50000, linetype = "dashed", color = "red") +
  labs(title = "Regresión Discontinua: Efecto del Subsidio en Ventas",
       x = "Ingresos Previos",
       y = "Ventas Mensuales Posteriores",
       color = "Subsidio") +
  theme_minimal()

```

